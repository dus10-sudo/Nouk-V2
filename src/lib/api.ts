'use server';import { supabase } from './supabase';import { cookies } from 'next/headers';import { randomUUID } from 'crypto';function ensureToken(){const store=cookies();const k='nouk_user_token';const existing=store.get(k)?.value;if(existing)return existing;const v=randomUUID();store.set(k,v,{httpOnly:false,sameSite:'lax',maxAge:60*60*24*365});return v;}export async function listRooms(){return await supabase.from('rooms').select('*').eq('is_active',true).order('title');}export async function getRoomBySlug(slug:string){const {data,error}=await supabase.from('rooms').select('*').eq('slug',slug).maybeSingle();if(error)return null;return data;}export async function listThreads(roomId:string){return await supabase.from('threads').select('*').eq('room_id',roomId).eq('is_archived',false).gt('expires_at',new Date().toISOString()).order('last_activity',{ascending:false});}export async function createThread(roomId:string,title:string){const user_token=ensureToken();return await supabase.from('threads').insert({room_id:roomId,title,user_token});}export async function getThread(id:string){const {data}=await supabase.from('threads').select('*').eq('id',id).maybeSingle();return data;}export async function listReplies(threadId:string){return await supabase.from('replies').select('*').eq('thread_id',threadId).order('created_at',{ascending:true});}export async function addReply(threadId:string,body:string){const user_token=ensureToken();return await supabase.from('replies').insert({thread_id:threadId,body,user_token});}